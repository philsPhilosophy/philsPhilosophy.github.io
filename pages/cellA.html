<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cellular Automata</title>
    <style>
        #automata {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        canvas {
            border: 1px solid black;
        }
        .rule-row {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        .rule-cell {
            width: 30px;
            height: 30px;
            border: 1px solid black;
            margin: 2px;
            background-color: white;
        }
        .rule-output {
            width: 30px;
            height: 30px;
            border: 1px solid black;
            margin: 2px;
            cursor: pointer;
        }
        .rule-output.black {
            background-color: black;
        }
    </style>
</head>
<body>
    <h1>Cellular Automata</h1>
    
    <!-- Rule Configuration -->
    <div id="rule-config">
        <!-- JavaScript will generate the 8 configurations here -->
    </div>
    
    <label for="steps">Number of Steps:</label>
    <input type="number" id="steps" name="steps" min="1">
    <button onclick="generateAutomata()">Generate</button>
    
    <div id="automata">
        <canvas id="canvas"></canvas>
    </div>

    <script>
        const configurations = [
            [1, 1, 1],
            [1, 1, 0],
            [1, 0, 1],
            [1, 0, 0],
            [0, 1, 1],
            [0, 1, 0],
            [0, 0, 1],
            [0, 0, 0]
        ];

        let ruleArray = new Array(8).fill(0); // Start with all rules set to 0

        function toggleOutput(index) {
            ruleArray[index] = ruleArray[index] === 0 ? 1 : 0;
            document.getElementById(`output-${index}`).classList.toggle('black');
        }

        function displayRuleConfig() {
            const ruleConfigDiv = document.getElementById('rule-config');
            ruleConfigDiv.innerHTML = ''; // Clear any existing content

            configurations.forEach((config, index) => {
                const row = document.createElement('div');
                row.classList.add('rule-row');

                // Create cells for the 3-cell configuration
                config.forEach(cell => {
                    const div = document.createElement('div');
                    div.classList.add('rule-cell');
                    div.style.backgroundColor = cell === 1 ? 'black' : 'white';
                    row.appendChild(div);
                });

                // Create the clickable output cell
                const output = document.createElement('div');
                output.classList.add('rule-output');
                output.id = `output-${index}`;
                output.addEventListener('click', () => toggleOutput(index));
                row.appendChild(output);

                ruleConfigDiv.appendChild(row);
            });
        }

        function generateAutomata() {
            const steps = document.getElementById('steps').value;

            if (steps === '') {
                alert('Please enter the number of steps.');
                return;
            }

            const numSteps = parseInt(steps);
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            // Calculate canvas size based on number of steps
            canvas.width = numSteps * 2;
            canvas.height = numSteps;

            const automata = new Array(numSteps).fill(0).map(() => new Array(numSteps * 2).fill(0));
            automata[0][numSteps] = 1;

            for (let i = 1; i < numSteps; i++) {
                for (let j = 1; j < numSteps * 2 - 1; j++) {
                    const left = automata[i - 1][j - 1];
                    const center = automata[i - 1][j];
                    const right = automata[i - 1][j + 1];
                    const binaryIndex = left * 4 + center * 2 + right;
                    automata[i][j] = ruleArray[7 - binaryIndex]; // Apply the user's rule
                }
            }

            context.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < numSteps; i++) {
                for (let j = 0; j < numSteps * 2; j++) {
                    context.fillStyle = automata[i][j] ? 'black' : 'white';
                    context.fillRect(j, i, 1, 1);
                }
            }
        }

        // Display the rule configuration on page load
        displayRuleConfig();
    </script>
</body>
</html>
